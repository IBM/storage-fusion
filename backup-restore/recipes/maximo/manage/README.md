Backup
----

### Steps for Maximo Manage namespace backup

1. cd to `maximo/manage`
2. Export Manage required variables, this can be achieving by sourcing the `maximo_env.sh`:
    ```
    MAS_INSTANCE_ID (REQUIRED)
    MAS_WORKSPACE_ID (REQUIRED)
    ```

    e.g
    `export MAS_INSTANCE_ID=inst1`
    `export MAS_WORKSPACE_ID=dev`


2. Run the prerequisite script, for more information, run with the `-h` option

    `./scripts/backup-pre-req.sh`

3. Apply the local recipe (frcpe) generated by the backup-pre-req script

    `oc apply -f maximo-manage-backup-restore-local.yaml`

4. From Fusion Console, create backup policy (fbp) specifying the frequency for backups
5. From Fusion Console, associate the backup policy to the Manage application. 
6. Retrieve the Policy Assignment Name:

    `oc get fpa -n ibm-spectrum-fusion-ns -o custom-columns=NAME:.metadata.name --no-headers`
7. Update policy assignments (fpa) with recipe name and namespace

    `oc -n ibm-spectrum-fusion-ns patch fpa <policy-assignment-name> --type merge -p '{"spec":{"recipe":{"name":"maximo-manage-backup-restore-recipe", "namespace":"ibm-spectrum-fusion-ns"}}}'`
    ```
    recipe:
        name: maximo-manage-backup-restore-recipe
        namespace: ibm-spectrum-fusion-ns
    ```

Restore
----
### Prerequisite: 
Maximo Core and its prerequisites.

**Optional:** Application db2u is optional prerequisite if it was configured on cluster

### Steps for Maximo Manage namespace restore
1. Before restoring application run the prerequisite script:

    `./scripts/restore-pre-req.sh`
2. Start Manage namespace restore to same or alternate cluster.

### Post Restore Task
1. After Manage application is restored, you need to evaluate if there is a need to manually modify `mxe.doclink.path01` property. For same cluster restore this step migth be not needed. 
2. From Manage application, go to System Properties and search for `mxe.doclink.path01` property. 
3. If during restore, cluster domain changed (as during alternate cluster restore), make sure to match to current MAS Manage URL. 
4. Save the modification made to this property. 
5. Perform a live refresh (No downtime needed).

e.g.
On Hub (Source), cluster domain was pointing to maximo-hub so `mxe.doclink.path01` is as follows
```
/DOCLINKS=https://dev.manage.<MAS_INSTANCE_ID>.maximo-hub/maximo/oslc/doclinks
```

During restore, Spoke (target) cluster domain changed to maximo-spoke, so modification is needed to match new MAS Manage URL
```
/DOCLINKS=https://dev.manage.<MAS_INSTANCE_ID>.maximo-spoke/maximo/oslc/doclinks
```