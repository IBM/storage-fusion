Backup
----

### Steps for Maximo Predict namespace backup

1. cd to `maximo/2.10.x/predict`
2. Export predict required variables, this can be achieving by sourcing the `maximo_env.sh`:
    ```
    MAS_INSTANCE_ID (REQUIRED)
    MAS_WORKSPACE_ID (REQUIRED)
    ```

    e.g
    `export MAS_INSTANCE_ID=inst1`
    `export MAS_WORKSPACE_ID=dev`


2. Run the prerequisite script, for more information, run with the `-h` option

    `./scripts/backup-pre-req.sh`

3. Apply the local recipe (frcpe) generated by the backup-pre-req script

    `oc apply -f maximo-predict-backup-restore-local.yaml`

Note: Following steps needs to be made on Hub cluster

4. From Fusion Console, create backup policy (fbp) specifying the frequency for backups
5. From Fusion Console, associate the backup policy to the Predict application. 
6. Retrieve the Policy Assignment Name:

    `oc get fpa -n ibm-spectrum-fusion-ns -o custom-columns=NAME:.metadata.name --no-headers`
7. Update policy assignments (fpa) with recipe name and namespace

    `oc -n ibm-spectrum-fusion-ns patch fpa <policy-assignment-name> --type merge -p '{"spec":{"recipe":{"name":"maximo-predict-backup-restore-recipe", "namespace":"ibm-spectrum-fusion-ns"}}}'`
    ```
    recipe:
        name: maximo-predict-backup-restore-recipe
        namespace: ibm-spectrum-fusion-ns
    ```

Restore
----
### Prerequisite: 
**Required:** <br>
1. Restore Maximo Application Suite with either [Suite](../suite/README.md) or [Core](../core/README.md) recipes and its optional prerequisites <br>
2. [Enable the Openshift internal image registry](https://www.ibm.com/docs/en/masv-and-l/continuous-delivery?topic=installing-enabling-openshift-internal-image-registry)

**Optional:** <br>
[Grafana](https://ibm-mas.github.io/ansible-devops/roles/grafana/): You must install same version (v4 or v5) as in source cluster if you were previously using Grafana <br>
Restore [AMQ-Streams](../amq-streams/README.md) namespace if configured in source cluster <br>
Restore [DB2](../db2u/README.md) namespace if configured in source cluster <br>
Restore [Manage](../manage/README.md) namespace if configured in source cluster <br>
Restore [IOT](../iot/README.md) namespace if configured in source cluster <br>
Restore [Monitor](../monitor/README.md) namespace if configured in source cluster <br>
Restore CPD instance (with Spark, Watson Studio and WML)
  - [Fusion Same cluster restore](https://www.ibm.com/docs/en/cloud-paks/cp-data/5.0.x?topic=fusion-restoring-online-backup-same-cluster)
  - [Fusion Alternate cluster restore](https://www.ibm.com/docs/en/cloud-paks/cp-data/5.0.x?topic=fusion-recovering-cloud-pak-data)

### Steps for Maximo predict namespace restore
1. Before restoring application run the prerequisite script:

    `./scripts/restore-pre-req.sh`
2. Start Predict namespace restore to same or alternate cluster.
